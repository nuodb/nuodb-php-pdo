--TEST--
blob1 -- test blob with nul byte.
--FILE--
<?php 

require("testdb.inc");
global $db;  
open_db();

try {

  $data = "This is\000a test.";
  if (strlen($data) != 15) {
      echo "FAIL: test data does not contain a NULL";
      die;
  }
  $sql = "DROP TABLE BLOB1 CASCADE IF EXISTS";
  $db->query($sql);
  $sql = "CREATE TABLE BLOB1 (ID INT GENERATED BY DEFAULT AS IDENTITY, BLOBFIELD BLOB DEFAULT NULL,	PRIMARY KEY (ID))";
  $db->query($sql);

  $sql = "INSERT INTO BLOB1 (BLOBFIELD) VALUES (:db_insert_placeholder_0)";
  $stmt = $db->prepare($sql);
  $stmt->bindParam(':db_insert_placeholder_0', $data, PDO::PARAM_LOB);
  $stmt->execute();
  $id = $db->lastInsertId();

  $sql = 'SELECT * FROM BLOB1 WHERE ID = :id';
  $stmt = $db->prepare($sql);
  $stmt->bindParam(':id', $id);
  $stmt->execute();
  $result = $stmt->fetchAll();
  if ($result[0]['BLOBFIELD'] != $data) {
      echo "FAIL: compare\n";
  }
  //print_r($result);
  $db = NULL;
} catch(PDOException $e) {
  echo $e->getMessage();
}
$db = NULL;
echo "done\n";

?>
--EXPECT--
done
